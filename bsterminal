#!/bin/bash

# BSTerminal - Busy Screen Terminal Simulator
# Makes it look like you're doing something important

# Colors
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
MAGENTA='\033[0;35m'
CYAN='\033[0;36m'
WHITE='\033[1;37m'
GRAY='\033[0;90m'
NC='\033[0m' # No Color

# Trap Ctrl+C to exit cleanly
trap 'echo -e "\n${GREEN}[✓] Process completed successfully${NC}"; exit 0' SIGINT SIGTERM

# Random delay function
random_delay() {
    local min=${1:-0.05}
    local max=${2:-0.3}
    sleep $(awk -v min=$min -v max=$max 'BEGIN{srand(); print min+rand()*(max-min)}')
}

# Progress bar function
show_progress() {
    local duration=$1
    local width=50
    local label=$2

    echo -ne "${CYAN}${label}${NC} ["
    for ((i=0; i<=width; i++)); do
        sleep $(echo "$duration / $width" | bc -l)
        echo -ne "${GREEN}█${NC}"
    done
    echo -e "] ${GREEN}100%${NC}"
}

# Simulate package installation
simulate_apt_install() {
    local packages=("libssl-dev" "python3-pip" "docker.io" "nodejs" "nginx" "postgresql" "redis-server" "git" "curl" "wget" "build-essential" "cmake" "vim" "tmux" "htop")
    local pkg=${packages[$RANDOM % ${#packages[@]}]}

    echo -e "${WHITE}Reading package lists...${NC}"
    random_delay 0.3 0.6
    echo -e "${WHITE}Building dependency tree...${NC}"
    random_delay 0.2 0.5
    echo -e "${WHITE}Reading state information...${NC}"
    random_delay 0.2 0.4
    echo -e "${GREEN}The following NEW packages will be installed:${NC}"
    echo -e "  $pkg"
    random_delay 0.3 0.5
    echo -e "${WHITE}0 upgraded, 1 newly installed, 0 to remove and 0 not upgraded.${NC}"
    random_delay 0.2 0.3
    echo -e "Need to get $(shuf -i 500-9999 -n 1) kB of archives."
    echo -e "After this operation, $(shuf -i 1000-50000 -n 1) kB of additional disk space will be used."
    random_delay 0.3 0.5
    echo -e "${CYAN}Get:1 http://archive.ubuntu.com/ubuntu jammy/main amd64 $pkg amd64 $(shuf -i 1-9 -n 1).$(shuf -i 0-99 -n 1) [$(shuf -i 100-9999 -n 1) kB]${NC}"
    show_progress 2 "Fetching"
    echo -e "${WHITE}Unpacking $pkg...${NC}"
    random_delay 0.5 1
    echo -e "${WHITE}Setting up $pkg...${NC}"
    random_delay 0.4 0.8
    echo -e "${GREEN}Processing triggers...${NC}"
    random_delay 0.3 0.5
    echo ""
}

# Simulate npm install
simulate_npm_install() {
    local packages=("react" "express" "lodash" "axios" "webpack" "babel" "typescript" "eslint" "prettier" "next" "vue" "angular")
    local pkg=${packages[$RANDOM % ${#packages[@]}]}

    echo -e "${GRAY}npm${NC} ${WHITE}WARN deprecated package@1.0.0: This package has been deprecated${NC}"
    random_delay 0.2 0.4
    echo -e "${CYAN}added${NC} $(shuf -i 50-300 -n 1) packages, and ${CYAN}audited${NC} $(shuf -i 400-1000 -n 1) packages in $(shuf -i 5-30 -n 1)s"
    random_delay 0.3 0.5
    echo ""

    for i in {1..5}; do
        local dep=${packages[$RANDOM % ${#packages[@]}]}
        echo -e "${GRAY}[$(shuf -i 1-5 -n 1)/5]${NC} ${CYAN}⠸${NC} reify:$dep: ${YELLOW}timing${NC} reifyNode:node_modules/$dep Completed in $(shuf -i 100-999 -n 1)ms"
        random_delay 0.1 0.3
    done

    echo -e "\n${GREEN}✓${NC} Successfully installed $pkg and dependencies"
    echo ""
}

# Simulate git operations
simulate_git_operations() {
    local operations=("clone" "pull" "fetch")
    local op=${operations[$RANDOM % ${#operations[@]}]}
    local repos=("react" "vue" "angular" "kubernetes" "docker" "tensorflow" "pytorch")
    local repo=${repos[$RANDOM % ${#repos[@]}]}

    if [ "$op" = "clone" ]; then
        echo -e "${WHITE}Cloning into '$repo'...${NC}"
        random_delay 0.3 0.5
        echo -e "${GRAY}remote: Enumerating objects: $(shuf -i 1000-50000 -n 1), done.${NC}"
        random_delay 0.2 0.4
        echo -e "${GRAY}remote: Counting objects: 100% ($(shuf -i 1000-5000 -n 1)/$(shuf -i 1000-5000 -n 1)), done.${NC}"
        random_delay 0.2 0.4
        echo -e "${GRAY}remote: Compressing objects: 100% ($(shuf -i 500-2000 -n 1)/$(shuf -i 500-2000 -n 1)), done.${NC}"
        show_progress 3 "Receiving objects"
        show_progress 2 "Resolving deltas"
        echo -e "${GREEN}✓${NC} Repository cloned successfully"
    else
        echo -e "${WHITE}Fetching origin...${NC}"
        random_delay 0.5 1
        echo -e "${GRAY}remote: Enumerating objects: $(shuf -i 10-100 -n 1), done.${NC}"
        random_delay 0.3 0.5
        echo -e "${GREEN}From github.com:user/$repo${NC}"
        echo -e "   $(openssl rand -hex 4)..$(openssl rand -hex 4)  main     -> origin/main"
        random_delay 0.2 0.4
        echo -e "${GREEN}✓${NC} Updated successfully"
    fi
    echo ""
}

# Simulate compilation
simulate_compilation() {
    local files=("main.cpp" "utils.cpp" "parser.cpp" "renderer.cpp" "engine.cpp" "network.cpp" "database.cpp")

    echo -e "${CYAN}Building target: Release${NC}"
    random_delay 0.3 0.5

    for i in {1..6}; do
        local file=${files[$RANDOM % ${#files[@]}]}
        echo -e "${YELLOW}[$(echo "scale=0; $i*100/6" | bc)%]${NC} Compiling ${BLUE}$file${NC}"
        random_delay 0.4 0.8
        echo -e "${GRAY}  g++ -O3 -std=c++17 -Wall -c $file -o ${file%.cpp}.o${NC}"
        random_delay 0.3 0.6
    done

    echo -e "${YELLOW}[100%]${NC} Linking..."
    random_delay 0.5 1
    echo -e "${GREEN}✓${NC} Build completed successfully"
    echo -e "${WHITE}  Time elapsed: $(shuf -i 10-60 -n 1).$(shuf -i 0-9 -n 1)s${NC}"
    echo ""
}

# Simulate docker operations
simulate_docker() {
    local images=("nginx:latest" "postgres:14" "redis:alpine" "node:18" "python:3.11" "mongo:latest")
    local img=${images[$RANDOM % ${#images[@]}]}

    echo -e "${WHITE}Pulling $img${NC}"
    random_delay 0.3 0.5

    for layer in $(seq 1 $(shuf -i 3-6 -n 1)); do
        local hash=$(openssl rand -hex 6)
        echo -e "${CYAN}$hash${NC}: Pulling fs layer"
        random_delay 0.1 0.2
    done

    echo ""
    for layer in $(seq 1 $(shuf -i 3-6 -n 1)); do
        local hash=$(openssl rand -hex 6)
        echo -e "${CYAN}$hash${NC}: Downloading [${GREEN}$(printf '=%.0s' {1..30})${NC}>${GRAY}$(printf ' %.0s' {1..10})${NC}] $(shuf -i 1-50 -n 1)MB/$(shuf -i 50-200 -n 1)MB"
        random_delay 0.2 0.4
    done

    echo -e "${GREEN}✓${NC} Pull complete"
    echo ""
}

# Simulate system updates
simulate_system_update() {
    echo -e "${CYAN}Checking for system updates...${NC}"
    random_delay 0.5 1
    echo -e "${WHITE}Found $(shuf -i 5-50 -n 1) packages to update${NC}"
    random_delay 0.3 0.6

    show_progress 3 "Downloading packages"
    show_progress 2 "Installing updates"

    echo -e "${GREEN}✓${NC} System updated successfully"
    echo -e "${WHITE}  Kernel: $(uname -r) -> $(uname -r | awk -F. '{print $1"."$2"."$3+1}')-generic${NC}"
    random_delay 0.3 0.5
    echo ""
}

# Simulate database operations
simulate_database() {
    local operations=("migration" "backup" "optimization")
    local op=${operations[$RANDOM % ${#operations[@]}]}

    if [ "$op" = "migration" ]; then
        echo -e "${CYAN}Running database migrations...${NC}"
        random_delay 0.3 0.5

        for i in {1..4}; do
            echo -e "${GREEN}✓${NC} Applied migration $(date +%Y%m%d)_$(shuf -i 100000-999999 -n 1)_update_schema.sql"
            random_delay 0.4 0.7
        done
        echo -e "${WHITE}  Migrations completed: 4${NC}"

    elif [ "$op" = "backup" ]; then
        echo -e "${CYAN}Creating database backup...${NC}"
        random_delay 0.5 0.8
        show_progress 3 "Dumping database"
        echo -e "${GREEN}✓${NC} Backup saved to: backup_$(date +%Y%m%d_%H%M%S).sql.gz"

    else
        echo -e "${CYAN}Optimizing database tables...${NC}"
        random_delay 0.3 0.5

        local tables=("users" "posts" "comments" "sessions" "logs" "analytics")
        for table in "${tables[@]}"; do
            echo -e "${YELLOW}⟳${NC} Analyzing table: $table"
            random_delay 0.3 0.6
            echo -e "${GREEN}✓${NC} Optimized $table ($(shuf -i 1000-50000 -n 1) rows)"
            random_delay 0.2 0.4
        done
    fi
    echo ""
}

# Simulate network diagnostics
simulate_network() {
    local hosts=("api.github.com" "registry.npmjs.org" "pypi.org" "hub.docker.com" "aws.amazon.com")
    local host=${hosts[$RANDOM % ${#hosts[@]}]}

    echo -e "${CYAN}Running network diagnostics for $host...${NC}"
    random_delay 0.3 0.5

    echo -e "${WHITE}PING $host ($(shuf -i 1-255 -n 1).$(shuf -i 1-255 -n 1).$(shuf -i 1-255 -n 1).$(shuf -i 1-255 -n 1)): 56 data bytes${NC}"

    for i in {1..5}; do
        local time=$(shuf -i 10-100 -n 1).$(shuf -i 0-9 -n 1)
        echo -e "${GRAY}64 bytes from $host: icmp_seq=$i ttl=64 time=$time ms${NC}"
        random_delay 0.8 1.2
    done

    echo -e "\n${GREEN}✓${NC} Network connectivity verified"
    echo ""
}

# Simulate log analysis
simulate_log_analysis() {
    echo -e "${CYAN}Analyzing system logs...${NC}"
    random_delay 0.3 0.5

    local levels=("INFO" "WARN" "DEBUG" "ERROR")
    local services=("nginx" "postgresql" "redis" "docker" "systemd")

    for i in {1..8}; do
        local level=${levels[$RANDOM % ${#levels[@]}]}
        local service=${services[$RANDOM % ${#services[@]}]}
        local color=$GRAY

        case $level in
            "ERROR") color=$RED ;;
            "WARN") color=$YELLOW ;;
            "INFO") color=$GREEN ;;
            "DEBUG") color=$BLUE ;;
        esac

        echo -e "${GRAY}$(date '+%Y-%m-%d %H:%M:%S')${NC} ${color}[$level]${NC} $service: $(shuf -i 1000-9999 -n 1) events processed"
        random_delay 0.2 0.5
    done

    echo -e "\n${GREEN}✓${NC} Log analysis complete"
    echo -e "${WHITE}  Total entries scanned: $(shuf -i 10000-99999 -n 1)${NC}"
    echo -e "${WHITE}  Errors found: $(shuf -i 0-5 -n 1)${NC}"
    echo ""
}

# Main loop
main() {
    clear
    echo -e "${BLUE}╔════════════════════════════════════════════════════════════╗${NC}"
    echo -e "${BLUE}║${NC}  ${CYAN}BSTerminal${NC} - Busy Screen Terminal Simulator         ${BLUE}║${NC}"
    echo -e "${BLUE}║${NC}  Press ${YELLOW}Ctrl+C${NC} to exit                                  ${BLUE}║${NC}"
    echo -e "${BLUE}╚════════════════════════════════════════════════════════════╝${NC}"
    echo ""
    sleep 1

    # Array of simulation functions
    simulations=(
        "simulate_apt_install"
        "simulate_npm_install"
        "simulate_git_operations"
        "simulate_compilation"
        "simulate_docker"
        "simulate_system_update"
        "simulate_database"
        "simulate_network"
        "simulate_log_analysis"
    )

    # Run random simulations indefinitely
    while true; do
        # Pick a random simulation
        local sim=${simulations[$RANDOM % ${#simulations[@]}]}
        $sim

        # Random pause between operations
        sleep $(shuf -i 1-3 -n 1)
    done
}

# Run the main function
main
